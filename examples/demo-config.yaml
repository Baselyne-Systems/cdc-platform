# Example pipeline configuration for the CDC demo.
# Pipeline defaults come from config/defaults/pipeline.yaml;
# only pipeline-specific fields need to be specified here.
#
# Secrets use ${VAR} or ${VAR:-default} syntax and are resolved
# from environment variables at load time.

pipeline_id: demo
topic_prefix: cdc

source:
  database: ${CDC_SOURCE_DATABASE:-cdc_demo}
  password: ${CDC_SOURCE_PASSWORD:-cdc_password}
  tables:
    - public.customers
    - public.orders

# Sink destinations â€” events are fan-out to all enabled sinks.
sinks:
  - sink_id: webhook-notifications
    sink_type: webhook
    enabled: true
    webhook:
      url: ${WEBHOOK_URL:-http://localhost:8000/cdc-events}
      method: POST
      headers:
        X-Source: cdc-platform
      timeout_seconds: 10

  - sink_id: analytics-db
    sink_type: postgres
    enabled: false
    postgres:
      host: ${ANALYTICS_DB_HOST:-localhost}
      port: ${ANALYTICS_DB_PORT:-5433}
      database: ${ANALYTICS_DB_NAME:-analytics}
      username: ${ANALYTICS_DB_USER:-cdc_writer}
      password: ${ANALYTICS_DB_PASSWORD:-cdc_writer_password}
      target_table: public.cdc_events
      batch_size: 50
      upsert: true

  - sink_id: iceberg-lake
    sink_type: iceberg
    enabled: false
    iceberg:
      catalog_uri: ${ICEBERG_CATALOG_URI:-sqlite:////tmp/cdc_catalog.db}
      warehouse: ${ICEBERG_WAREHOUSE:-file:///tmp/cdc_warehouse}
      table_name: customers_cdc
      write_mode: append
      batch_size: 500
      auto_create_table: true
